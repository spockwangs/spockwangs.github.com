---
layout: post
title: C++ Coding Guideline
tags:
- Programming
status: publish
type: post
published: true
meta:
  _edit_last: '1'
  _edit_lock: '1353842551'
  _pingme: '1'
  _encloseme: '1'
  _wp_old_slug: ''
---
<h3>Declare the constructor and destructor in the header file and define them in the source file when using Pimpl idiom, even if they are empty.</h3>
Consider the following code.
<pre>
// pimpl.h
class Impl;    // forward declaration
class Pimpl {
public:
   Pimpl();
private:
    boost::scoped_ptr&lt;Impl&gt; m_impl;
};
</pre>
<pre>
// pimpl.cc
class Impl {
     // ...
};
<br />
Pimpl::Pimpl()
    : m_impl(new Impl)
{}
</pre>

If you do not declare the destructor the compiler will generate one in every translation unit that includes <code>"impl.h"</code>, which will call the destructor of member variables, that is, the destructor of <code>m_impl</code> which requires the complete definition of <code>Impl</code>. But the whole purpose of Pimpl idiom is to hide the definition of <code>Impl</code>. To solve this problem you should declare the destructor in the header file to prevent the compiler from generating one and define it in the source file. Then only the "impl.cc" requires the complete definition of <code>Impl</code>. Other translation units just call <code>Pimpl</code>'s destructor as an external function, so they don't  need to generate it.
