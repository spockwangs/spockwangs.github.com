---
layout: post
title: Symbol resolution by GNU ld
tags:
- Programming
status: publish
type: post
published: true
meta:
  _edit_last: '1'
  _edit_lock: '1328193063'
  _pingme: '1'
  _encloseme: '1'
  _wp_old_slug: ''
---
<h2>Symbol Resolution</h2>
When a symbol appeared multiple times in object files being combined asymbole resolution process is called by the link editor to determine whichsymbol is taken. The resolution of two symbols with the same namedepends on the symbol's attributes (its binding, defineness and size). Seepage 67 of [<a href="#gabi41">Gabi4</a>].

<dl> <dt> Global </dt> <dd>Global symbols are those whose binding is <code>STB_GLOBAL</code>. They are visible to all object files being combined. </dd> <dt> Weak </dt> <dd> Weak symbols are binding is <tt>STB_WEAK</tt>. They resemble global symbols, but their definitions have lower precedence. It can be further categorized into two kinds: undefined weak symbols and defined weak symbols. </dd> <dt> Common </dt> <dd> Common symbols are those whose section index is <tt>STN_COMMON</tt>. They are defined but have not been allocated. Its final size are not determined until the symbol resolution process is complete. </dd> <dt> Undefined </dt> <dd> Undefined symbols are those whose section index is <tt>STN_UNDEF</tt>. </dd> </dl>The rules for symbol resolution is as follows.
<ol>
	<li> If a global symbol exists it can only appeared once in object files being combined. Multipe definitions of global symbols with the same name will cause an error. On the other hand, if a definition of a global symbol eixists, the appearence of weak symbols and/or common symbols with the same name will not cause an error. The link editor honors the global definition and ignores the weak and/or common ones.</li>
	<li> Otherwise, if a common symbol exists, the appearence of weak symbols with the same name will not cause an error. The link editor honors the common definition and ignores the weak ones. If muliple common symbols with the same name exists, the link editor honors the common definition with the biggest size.</li>
	<li> Otherwise, multiple appearences of weak symbols with the same name do not cause an error.
<ol>
	<li> If some of the weak symbols are defined (the section index is a positive integer), the link editor will honor the first found defined symbol and inogre the others.</li>
	<li> Otherwise, if all the weak symbols are undefined, the symbol will be left as an undefined weak symbol in the output file no matter what type of output file is being generated. In addition, if a executable is being generated, all the reference to the symbol will be assigned a value of zero. In the case of dynamic shared object, during process execution, the dynamic linker searches for this symbol. If the dynamic linker does not find a match, it binds a reference to a address of zero instead of generating a fatal runtime relocation error.</li>
</ol>
</li>
</ol>
<h2>Testing Existence of Functionality</h2>
Undefined weak refenrenced symbols may provide a useful mechanism fortesting the existence of functionality. For example, the following C codefragment might have been used in the shared object<tt>libfoo.so.1</tt>:
<pre class="borderindent">#pragma weak foo

extern void foo(char *);

void bar(char *path)
{
    void (*fptr)(char *);
    if ((fptr = foo) != 0)
        (*fptr)(path);
}</pre>
When application is built against <tt>libfoo.so.1</tt>, the link editor willcomplete successfully regardless of whether a definition for the symbol<tt>foo</tt> is found. If during execution of the application the functionaddress tests nonzero, the function is called. However, if the symboldeÔ¨Ånition is not found, the function address tests zero and so it is notcalled. See page 45 of [<a href="symbols.html#sun04">Sun04</a>].
<h2>Refenrences</h2>
<ul>
	<li> <a name="gabi4"></a><a href="http://www.sco.com/developers/devspecs/gabi41.pdf">System V ABI Edition 4.1, 1997</a>.</li>
	<li> <a name="sun04"></a>Sun Microsystems, Inc. <a href="http://download.oracle.com/docs/cd/E19683-01/817-3677/817-3677.pdf"><em>Linker and Libraries Guide</em></a>, 2004.</li>
</ul>
<hr /><em>Updated: 2011-03-04 16:14</em>
