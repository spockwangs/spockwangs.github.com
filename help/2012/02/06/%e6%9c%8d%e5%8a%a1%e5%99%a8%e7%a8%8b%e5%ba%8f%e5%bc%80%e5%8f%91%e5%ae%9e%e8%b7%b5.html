<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="author" content="" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/stylesheets/default.css" />
    <title>服务器程序开发实践</title>
  </head>
  <body>
    <div id="doc">
      <header class="header">
        <h1 class="title">judewang.github.com</h1>
        <div id="main-nav">
          <ul class="nav">
            <li class="nav-tab">
              <a href="/">Home</a>
            </li>
            <li class="nav-tab">
              <a href="/">Archives</a>
            </li>
            <li class="nav-tab">
              <a href="/">About</a>
            </li>
          </ul>
        </div>
      </header>
      
      <div id="bd">
        <div class="grid-left">
          <article id="article" class="article">
            <div class="article-title">服务器程序开发实践</div>
            <div class="article-author">By judewang</div>
            <div class="article-date">2012-02-06</div>
            <h2>如何打印日志</h2>
<p>
按打印日志的目的，日志可分为两大类：功能日志和调试日志。功能日志是程序的需求要求打印的，一般是为了统计之用，格式固定并指定了打印的目的地，这里略去不讨论。调试日志是为了调试程序bug打印的。
</p>
<p>
既然调试日志是为了调试之用，为了弄清楚需要打印什么信息，我们先了解一下调试需要哪些信息。
</p>
<p>
当我们看到一条错误日志时我们迫切需要知道的是这一条日志是哪一行代码打印的，所以每一条日志都应该包含这一条日志是哪一个源文件的哪一行代码以及是哪一个函数打印的，就向下面这样：
<pre>
filename.cpp:103: in function foo(): something is wrong
</pre>
</p>
<p>
服务器程序最容易出现问题的地方主要有两个来源：访问其它服务和请求处理耗时。前者出问题主要在于对其它服务的API了解不足导致的，后者主要在于难于准确估计程序每一部分的耗时。为了解决第一个问题，我们可以在访问其它服务时打印一条日志，包括请求和响应信息。这样在出现访问其它服务出现问题时可以及时查出来。这些日志应该打印到一个单独的文件。为了解决第二个问题，我们可以把请求的处理细分为几个过程，打印每一个过程的耗时。这些日志也应该打印到一个单独的文件中。
</p>
<p>
为了及早逮住程序的bug，我们通常都会在代码中加入大量的<code>assert</code>宏。当<code>assert</code>失败时说明程序有bug，这时我们也应该打印一条错误日志。
</p>
<p>
如果程序的目的是为别的程序提供公共的API服务的话，我们还需要打印其它程序访问这个程序的输入和输出信息，以便尽快定位是调用方还是被调方的bug，这样在调用方的开发者询问调用是否正确时我们就不会手足无措了。这个日志也应该打印到单独的文件中。
</p>
<p>
总结一下：
<ul>
  <li>程序运行流程的相关信息以及错误信息（包括<code>assert</code>失败的信息）都打印到一个单独的文件中，以便分析程序自身的bug。</li>
  <li>访问其它服务的请求和响应信息要打印到一个单独的文件中。</li>
  <li>其它程序访问本程序的请求和响应信息打印到一个单独的文件中。</li>
</ul>
</p>
<h2>C++容器开发实践</h2>
<ul>
  <li>每一个Command应该表示一个动作，而不是一个业务。业务应该以查询参数提供。相似的页面应该用同一个command产生。</li>
  <li>如果需要动态产生一个URL访问一个Command，那么这个被访问的Command应该提供一个静态成员函数生成这个URL。这样，产生和解析这个URL的逻辑对外是不可见的，更易维护。</li>
</ul>

          </article>
        </div>

        <div class="grid-right">
          <div class="toc">
            <div class="hd">
              Table of Contents
            </div>
            <div id="toc" class="bd">
            </div>
          </div>
        </div>
      </div>
      <footer class="footer">
        <p class="copyright">&copy; 2013 judewang<br />All rights reserved.</p>
      </footer>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
      <script src="/javascripts/generate_toc.js"></script>
    </div>
  </body>
</html>
