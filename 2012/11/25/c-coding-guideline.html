<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="author" content="" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/stylesheets/base.css" />
    <link rel="stylesheet" href="/stylesheets/screen.css" media="screen" />
    <title>C++ Coding Guideline</title>
  </head>
  <body>
    <header id="header">
      <h1 id="title"><a href="/">Spockwang's Thoughts</a></h1>
    </header>

    <nav id="nav">
      <ul id="menus-wrap">
        <li class="menu first"><a href="/">Archives</a></li>
        <li class="menu"><a href="/about.html">About</a></li>
      </ul>
    </nav>

    <div id="main" class="col-wrapper">
      <div id="content-wrapper" class="col-3-4">
        <div id="content">
          <article id="article">
  <header>
    <h1 class="title">C++ Coding Guideline</h1>
    <div class="meta grid">
      
      <li class="thetag"><a href="/tags/Programming" title='Posts tagged"Programming"'>Programming</a></li>
      
      <li class="meta-date right">2012-11-25</li>
    </div>
  </header>
  <div id="toc-wrapper" class="is-invisible">
    <div class="toc-header">Table of Contents</div>
    <div id="toc">
    </div>
  </div>
  <div id="article-content" class="content">
    <h2>Pimpl idiom</h2>

<p><strong>Declare the constructor and destructor in the header file and define them in the source file when using Pimpl idiom, even if they are empty.</strong></p>

<p>Consider the following code.</p>

<pre><code>// pimpl.h
class Impl;    // forward declaration
class Pimpl {
public:
   Pimpl();

   // The destructor is not declared, so the compiler will generate one.

private:
    boost::scoped_ptr&lt;Impl&gt; m_impl;
};

// pimpl.cc
class Impl {
     // ...
};

Pimpl::Pimpl()
    : m_impl(new Impl)
{}
</code></pre>

<p>If you do not declare the destructor the compiler will generate one in
every translation unit that includes <code>impl.h</code>, which will call
the destructor of member variables, that is, the destructor
of <code>m_impl</code> which requires the complete definition
of <code>Impl</code>. But the whole purpose of Pimpl idiom is to hide the
definition of <code>Impl</code>. To solve this problem you should declare
the destructor in the header file to prevent the compiler from generating
one, and define it in the source file. Then only the <code>impl.cc</code> requires the
complete definition of <code>Impl</code>. Other translation units just
call <code>Pimpl</code>'s destructor as an external function, so they don't
need to generate it.</p>

<h2>Prefer anonymous namespace functions to class static functions.</h2>

<p>When you are implementing a class's interface, you may need some helper
functions which has no relation with the private (member or static)
data. You can either declare the helper functions as the private static
functions in the class header file, or as the anonymous namespace functions
in the class source file.</p>

<p>Since it does not need to access the private data, the helper function
should be kept out of the class definition to make them loosely
coupled. And it is the implementation's details, which we don't want the
client of the class see it. So if we can put it outside the header file, we
should do it. If we put it in the header file, every time the
implementation changes the client using this class has to be
re-compiled. So we should put the implementation details outside of the
class header file as much as possible.</p>

  </div>
  <footer class="footer">
    
    <div class="footer-previous">
      <a href="/2012/05/16/mysql-help.html" title="Previous post: MySql Help">«MySql Help</a>
    </div>
    
    
    <div class="footer-next">
      <a href="/2013/02/25/hello.html" title="Next post: Hello">Hello»</a>
    </div>
    
  </footer>
</article>

<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'judewang'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        </div>
      </div>
      <div id="sidebar" class="col-1-4">
        <div class="tag-wrapper">
          <h1>Tags</h1>
          <ul class="tag-list">
            
            <li class="tag-item"><span class="thetag"><a href="/tags/Programming/" title='Posts tagged "Programming"'>Programming</a></span>&nbsp;x&nbsp;18</li>
            
            <li class="tag-item"><span class="thetag"><a href="/tags/quote/" title='Posts tagged "quote"'>quote</a></span>&nbsp;x&nbsp;2</li>
            
            <li class="tag-item"><span class="thetag"><a href="/tags/Administration/" title='Posts tagged "Administration"'>Administration</a></span>&nbsp;x&nbsp;5</li>
            
            <li class="tag-item"><span class="thetag"><a href="/tags/programming/" title='Posts tagged "programming"'>programming</a></span>&nbsp;x&nbsp;2</li>
            
            <li class="tag-item"><span class="thetag"><a href="/tags/Network/" title='Posts tagged "Network"'>Network</a></span>&nbsp;x&nbsp;3</li>
            
            <li class="tag-item"><span class="thetag"><a href="/tags/css/" title='Posts tagged "css"'>css</a></span>&nbsp;x&nbsp;1</li>
            
            <li class="tag-item"><span class="thetag"><a href="/tags/mysql/" title='Posts tagged "mysql"'>mysql</a></span>&nbsp;x&nbsp;1</li>
            
            <li class="tag-item"><span class="thetag"><a href="/tags/character set/" title='Posts tagged "character set"'>character set</a></span>&nbsp;x&nbsp;1</li>
            
            <li class="tag-item"><span class="thetag"><a href="/tags/object-oriented/" title='Posts tagged "object-oriented"'>object-oriented</a></span>&nbsp;x&nbsp;1</li>
            
            <li class="tag-item"><span class="thetag"><a href="/tags/concurrency/" title='Posts tagged "concurrency"'>concurrency</a></span>&nbsp;x&nbsp;1</li>
            
          </ul>
        </div>
      </div>
    </div>

    <footer id="footer">
      <p class="copyright">Copyright&nbsp;&copy;&nbsp2013 - judewang - Powered by jekyll</p>
    </footer>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="/javascripts/generate_toc.js"></script>
    <script src="//google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
    <script type="text/javascript">
      <!-- Add Google prettify support. -->
      $(function () {
          $("pre > code").addClass("prettyprint");
      });
      </script>
    </div>
  </body>
</html>
